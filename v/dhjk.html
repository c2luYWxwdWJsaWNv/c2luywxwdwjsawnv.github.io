<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="none">
  <meta name="referrer" content="no-referrer">
  <meta name="theme-color" content="black">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/sinalpublico/ply@main/assets/css/player-v3.1.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
  <script src="https://fastly.jsdelivr.net/npm/disable-devtool@latest/disable-devtool.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p2p-media-loader-core@latest/build/p2p-media-loader-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p2p-media-loader-hlsjs@latest/build/p2p-media-loader-hlsjs.min.js"></script>
  <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwpsrv.js"></script>
  <script src="https://ssl.p.jwpcdn.com/player/v/8.33.2/provider.hlsjs.js"></script>
  <script src="https://ssl.p.jwpcdn.com/player/v/8.33.2/jwplayer.core.controls.js"></script>
  <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
  <style type="text/css">
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
    
    #player {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        height: 100%;
        width: 100%;
        border: 0;
        overflow: hidden;
    }
    
    #hidden-frame {
        position: absolute;
        top: -1000px;
        left: -1000px;
        width: 1px;
        height: 1px;
        border: none;
    }
  </style>
  <script>
    jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';
  </script>
</head>

<body>
  <div id="player"></div>
  <iframe id="hidden-frame"></iframe>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }
    
        const videoLink = getQueryParam('id');
    
        if (videoLink) {
            const hiddenFrame = document.getElementById('hidden-frame');
            hiddenFrame.src = videoLink;
    
            hiddenFrame.onload = function() {
                fetch(`https://corsproxy.io/?url=${encodeURIComponent(videoLink)}`)
                    .then(response => response.text())
                    .then(data => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(data, 'text/html');
                        
                        const scriptTags = doc.querySelectorAll('script');
                        let videoSourceLink = '';
    
                        scriptTags.forEach(script => {
                            const scriptContent = script.textContent;
                            if (scriptContent.includes('return null==c')) {
                                const linkMatch = scriptContent.match(/return\s+null==c\?"([^"]+)":unescape\(c\[1\]\)/);
                                if (linkMatch) {
                                    videoSourceLink = linkMatch[1];
                                }
                            }
                        });
    
                        if (videoSourceLink) {
                            var playerInstance = jwplayer("player");
                            playerInstance.setup({
                                playlist: [{
                                    sources: [{
                                        default: false,
                                        type: "hls",
                                        file: videoSourceLink,
                                        drm: {
                                            fairplay: {}
                                        },
                                        label: "0"
                                    }, {
                                        default: true,
                                        type: "hls",
                                        file: videoSourceLink,
                                        drm: {
                                            widevine: {},
                                            playready: {}
                                        },
                                        label: "1"
                                    }]
                                }],
                                primary: "html5",
                                hlshtml: "true",
                                width: "100%",
                                height: "100%",
                                aspectratio: "16:9",
                                stretching: "exactfit",
                                autostart: true,
                                cast: true,
                                hlsjsConfig: {
                                    debug: false,
                                    p2pConfig: {
                                        live: true,
                                    }
                                },
                            });
    
                            playerInstance.on('play', function() {
                                playerInstance.hls.p2pEngine.on('stats', function({totalHTTPDownloaded, totalP2PDownloaded}) {
                                    // Obtenha totalHTTPDownloaded e totalP2PDownloaded aqui
                                });
                            });
                        } else {
                            document.getElementById('player').innerHTML = 'Link do vídeo não encontrado.';
                        }
                    })
                    .catch(error => {
                        document.getElementById('player').innerHTML = 'Erro ao carregar o conteúdo.';
                        console.error('Erro:', error);
                    });
            };
            
            hiddenFrame.onerror = function() {
                document.getElementById('player').innerHTML = 'Erro ao pré-carregar o conteúdo.';
            };
        } else {
            document.getElementById('player').innerHTML = 'Parâmetro de vídeo não fornecido.';
        }
    });
  </script>
</body>

</html>
